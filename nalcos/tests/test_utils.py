import numpy as np
import pytest
from nalcos.utils import (
    get_owner_and_repo,
    is_local_git_repo,
    is_github_repo,
    get_type_of_location,
    get_model,
)


def test_get_owner_and_repo():
    assert get_owner_and_repo("thepushkarp/nalcos") == ("thepushkarp", "nalcos")
    assert get_owner_and_repo("thepushkarp/nalcos/") == ("thepushkarp", "nalcos")
    assert get_owner_and_repo("/thepushkarp/nalcos") == ("thepushkarp", "nalcos")
    assert get_owner_and_repo("/thepushkarp/nalcos/") == ("thepushkarp", "nalcos")


def test_is_local_git_repo():
    assert is_local_git_repo("nalcos_pytest")
    assert not is_local_git_repo("not_nalcos")


def test_is_github_repo():
    assert is_github_repo("thepushkarp/nalcos")
    assert is_github_repo("thepushkarp/nalcos/")
    assert is_github_repo("/thepushkarp/nalcos")
    assert is_github_repo("/thepushkarp/nalcos/")
    assert not is_github_repo("thepushkarp/not_nalcos")
    assert not is_github_repo("thepushkarp/not_nalcos/test")
    assert not is_github_repo("nalcos_pytest")
    assert not is_github_repo("thepushkarp/private")


def test_get_type_of_location():
    assert get_type_of_location("nalcos_pytest") == "local"
    assert get_type_of_location("thepushkarp/nalcos") == "github"
    with pytest.raises(ValueError):
        get_type_of_location("thepushkarp/not_nalcos")
    with pytest.raises(ValueError):
        get_type_of_location("not_nalcos")


def test_get_model():
    assert (
        get_model().encode("This is a test.")
        == np.asarray(
            [
                7.31913820e-02,
                9.68165882e-03,
                -6.40471280e-02,
                2.85605621e-02,
                2.02334709e-02,
                -2.90142819e-02,
                3.99478525e-02,
                1.23079112e-02,
                1.64038762e-02,
                1.78985968e-02,
                6.61612302e-02,
                -3.56549323e-02,
                -3.99707444e-02,
                3.20413597e-02,
                -3.08308452e-02,
                -8.66078287e-02,
                1.74147021e-02,
                -6.66795000e-02,
                4.74463552e-02,
                3.35242562e-02,
                4.16781083e-02,
                1.20019913e-03,
                6.04017312e-03,
                -7.18336832e-03,
                -1.85436904e-02,
                3.14396508e-02,
                -3.52665186e-02,
                3.24788168e-02,
                2.80424468e-02,
                -4.98671234e-02,
                -8.46350659e-03,
                5.64837903e-02,
                3.32043134e-03,
                2.68113129e-02,
                9.98620875e-03,
                -5.16213337e-03,
                3.62143517e-02,
                -1.19290566e-02,
                -8.58651288e-03,
                4.26935218e-02,
                1.55442627e-02,
                -1.35396346e-01,
                5.49108870e-02,
                4.69426811e-03,
                4.82007861e-02,
                7.31604248e-02,
                -2.46811304e-02,
                1.54067781e-02,
                -8.29989556e-03,
                2.01747031e-03,
                2.55137179e-02,
                -4.67115045e-02,
                -8.34134519e-02,
                2.21429374e-02,
                2.08171606e-02,
                1.74925651e-03,
                -8.12877640e-02,
                -7.81705603e-02,
                -1.47342654e-02,
                1.50757411e-03,
                2.62155812e-02,
                6.74654618e-02,
                -2.05630474e-02,
                1.08965293e-01,
                7.30880722e-02,
                8.31793249e-03,
                7.68737495e-03,
                -6.70362860e-02,
                6.42744079e-02,
                -1.09118707e-01,
                -1.60754900e-02,
                -6.21293113e-02,
                -4.16263491e-02,
                -2.51244078e-03,
                3.02072261e-02,
                -3.50535661e-02,
                -5.09703420e-02,
                -6.25328394e-03,
                4.83797456e-04,
                5.93755348e-03,
                -5.39702997e-02,
                -7.46797994e-02,
                2.78767687e-03,
                -1.03754336e-02,
                8.76478925e-02,
                4.02146466e-02,
                1.02827571e-01,
                6.08817674e-03,
                -1.27470464e-01,
                2.14913487e-02,
                -1.24430554e-02,
                1.68919321e-02,
                -1.27721345e-02,
                3.30703296e-02,
                -9.39981341e-02,
                8.10842961e-02,
                -5.91641478e-02,
                -2.77692266e-02,
                1.43851908e-02,
                8.56997743e-02,
                -5.46649806e-02,
                -4.36860994e-02,
                -7.02156499e-02,
                -5.14236279e-02,
                -6.61050081e-02,
                -1.41796842e-02,
                3.98002826e-02,
                5.78929065e-03,
                5.33648022e-02,
                4.84967418e-02,
                -4.16921116e-02,
                1.12173660e-02,
                4.95077297e-02,
                1.46429157e-02,
                3.03027406e-03,
                -6.58000186e-02,
                -1.84159982e-03,
                2.10803337e-02,
                -4.23872359e-02,
                5.35201319e-02,
                3.71688083e-02,
                -1.67661831e-02,
                -2.56819706e-02,
                -6.49024695e-02,
                9.05288849e-03,
                -1.24661870e-01,
                -4.30054143e-02,
                3.45960800e-31,
                8.96327849e-03,
                -4.79331613e-02,
                6.79350868e-02,
                8.37194696e-02,
                -6.26945915e-03,
                3.98983136e-02,
                -5.84548786e-02,
                2.93768812e-02,
                3.04317046e-02,
                2.09249686e-02,
                4.42964025e-03,
                -2.95472685e-02,
                2.27493769e-03,
                6.30991021e-03,
                3.44756395e-02,
                2.85435077e-02,
                2.57972023e-03,
                1.38233870e-01,
                -2.38779094e-02,
                -2.07104329e-02,
                -6.13585971e-02,
                -5.95520549e-02,
                -3.78293172e-02,
                -1.36250993e-02,
                4.24854085e-02,
                -8.64816830e-02,
                -3.26482877e-02,
                -6.97499737e-02,
                -3.31190904e-03,
                2.18711887e-02,
                -4.14852519e-03,
                4.79868613e-02,
                -6.23604618e-02,
                3.16683459e-03,
                1.99435391e-02,
                8.86741802e-02,
                1.22586684e-02,
                -5.88150369e-03,
                1.98804159e-02,
                -1.60040241e-02,
                -1.73133872e-02,
                -1.01987831e-02,
                9.24829859e-03,
                3.55428644e-03,
                -1.45639721e-02,
                -4.63536531e-02,
                -2.57933531e-02,
                -7.22404420e-02,
                -2.67790239e-02,
                1.82874314e-02,
                3.12656239e-02,
                8.82179476e-03,
                1.00191832e-02,
                4.51226756e-02,
                1.75726768e-02,
                1.03232108e-01,
                4.45172600e-02,
                2.64010951e-02,
                -5.12073115e-02,
                5.41894622e-02,
                3.86700146e-02,
                6.15935996e-02,
                7.21972585e-02,
                3.33439223e-02,
                -1.10271804e-01,
                2.57820487e-02,
                -2.55509894e-02,
                -3.08574084e-02,
                7.11660683e-02,
                -1.38219213e-02,
                9.01215449e-02,
                -3.00786588e-02,
                5.40974550e-02,
                7.35959737e-03,
                -4.49760072e-02,
                -3.00679635e-02,
                -6.43069446e-02,
                2.93838494e-02,
                -1.79855693e-02,
                -4.50742655e-02,
                5.31007024e-03,
                -8.08098242e-02,
                1.39796287e-02,
                -1.09169297e-02,
                -6.73201904e-02,
                -7.78145017e-03,
                -7.13829249e-02,
                -5.18610049e-03,
                -1.19775096e-02,
                -3.93347777e-02,
                -5.81408106e-02,
                9.24134627e-03,
                4.13245745e-02,
                -1.15921944e-01,
                -3.95108610e-02,
                -2.49987792e-33,
                -2.38287803e-02,
                1.93280317e-02,
                -1.54953590e-02,
                1.09965377e-01,
                -1.23664951e-02,
                -1.47988591e-02,
                7.63767511e-02,
                7.91336596e-02,
                -2.67240349e-02,
                5.98471873e-02,
                9.71931964e-02,
                -4.38493490e-02,
                -7.76000097e-02,
                -2.09795423e-02,
                5.66246472e-02,
                3.55528072e-02,
                4.22033407e-02,
                -1.95394605e-02,
                -6.17275434e-03,
                1.77048706e-02,
                -4.33763415e-02,
                3.10982555e-01,
                5.23779057e-02,
                1.36951301e-02,
                -2.38892324e-02,
                7.16872215e-02,
                -1.33716092e-02,
                -5.59603088e-02,
                -5.20960763e-02,
                2.89329570e-02,
                4.28896695e-02,
                1.31001417e-02,
                -1.54132679e-01,
                2.31268145e-02,
                3.90587486e-02,
                -4.34293151e-02,
                2.39375401e-02,
                -1.45838344e-02,
                -3.55969444e-02,
                4.04047780e-02,
                2.64812652e-02,
                6.52254373e-02,
                7.65970051e-02,
                4.81924340e-02,
                3.46329808e-02,
                6.34691194e-02,
                9.21937451e-02,
                1.73524264e-02,
                -2.55960822e-02,
                1.77401379e-02,
                2.24719029e-02,
                2.25156499e-03,
                6.37732968e-02,
                2.08083317e-02,
                2.10130494e-02,
                8.63624809e-05,
                1.69021711e-02,
                -4.63621989e-02,
                -9.19770226e-02,
                7.08953142e-02,
                3.82911973e-02,
                5.29790781e-02,
                -1.35345086e-02,
                1.81364510e-02,
                6.00797497e-02,
                3.13172862e-03,
                -4.88649681e-02,
                5.53030074e-02,
                7.32975453e-02,
                5.65588148e-03,
                5.52245267e-02,
                -3.38251190e-03,
                -9.16715129e-04,
                -1.41022876e-01,
                -1.88073739e-02,
                -7.09702969e-02,
                -1.31206699e-02,
                4.19708043e-02,
                -6.41524717e-02,
                -6.29255772e-02,
                -1.33426026e-01,
                -2.14694366e-02,
                -1.21939005e-02,
                -4.09223931e-03,
                -6.21822104e-02,
                -3.41103002e-02,
                -4.23259859e-04,
                -2.16188189e-02,
                5.94712887e-03,
                9.54772085e-02,
                4.35065515e-02,
                1.45704066e-03,
                -5.74613512e-02,
                -6.31144270e-02,
                4.57742363e-02,
                -4.30439546e-33,
                -1.20587153e-02,
                -1.62812062e-02,
                -4.55214083e-02,
                -1.06359692e-02,
                -5.24241589e-02,
                -9.93540697e-03,
                4.61923983e-03,
                -3.66683006e-02,
                -3.64500768e-02,
                -6.78297281e-02,
                4.46759630e-03,
                -6.53637247e-03,
                -5.27415164e-02,
                3.12611721e-02,
                -9.16122459e-03,
                -7.10191056e-02,
                -5.12628518e-02,
                1.18151130e-02,
                -4.13180962e-02,
                1.18303369e-03,
                -1.25689693e-02,
                6.57954663e-02,
                -4.02759248e-03,
                8.54951218e-02,
                -2.30809264e-02,
                2.14559305e-02,
                2.66757626e-02,
                6.68687671e-02,
                -2.05921549e-02,
                -2.38470238e-04,
                2.19245511e-03,
                1.95005257e-02,
                -4.78159226e-02,
                -4.72322032e-02,
                -7.20062181e-02,
                6.05776273e-02,
                4.07826379e-02,
                2.21034735e-02,
                -1.61309894e-02,
                2.51830230e-03,
                -8.56662318e-02,
                3.07454318e-02,
                2.62479875e-02,
                6.24669865e-02,
                5.43266945e-02,
                -1.25017017e-02,
                -8.54339600e-02,
                -2.70850118e-02,
                3.68217118e-02,
                -4.50827256e-02,
                -1.41980359e-02,
                4.12615091e-02,
                1.26331178e-02,
                -5.50268032e-02,
                -6.47740206e-03,
                -2.17925459e-02,
                1.03182038e-02,
                1.45883150e-02,
                -7.01501891e-02,
                -1.33305080e-02,
                1.03428878e-01,
                -3.57946977e-02,
                1.60974681e-01,
                3.89878005e-02,
            ],
            dtype=np.float32,
        )
    ).all()
